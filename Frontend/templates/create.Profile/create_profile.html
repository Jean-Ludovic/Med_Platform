{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de Profil</title>
    <link rel="stylesheet" href="{% static 'profile.Form.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.7.4/lottie.min.js"></script>
    <style>
        #lottie-container {
            display: none; /* Masque l'animation jusqu'à la soumission */
            width: 100px;
            height: 100px;
            margin-top: 20px;
        }
        .formbold-error p {
            color: red;
            font-size: 0.9em;
        }
    </style>
    <script>
        const specialities = ["Cardiologie", "Dermatologie", "Pédiatrie", "Neurologie", "Oncologie", "Ophtalmologie", "Orthopédie", "Psychiatrie", "Radiologie"];

        function toggleFields() {
            const occupation = document.getElementById('occupation').value;
            const licenceField = document.getElementById('licenceField');
            const specialityField = document.getElementById('specialityField');
            licenceField.style.display = (occupation === 'docteur') ? 'block' : 'none';
            specialityField.style.display = (occupation === 'docteur') ? 'block' : 'none';
        }

        function filterSpecialities(inputId, datalistId) {
            const input = document.getElementById(inputId);
            const datalist = document.getElementById(datalistId);
            const query = input.value.toLowerCase();
            datalist.innerHTML = "";

            specialities
                .filter(speciality => speciality.toLowerCase().includes(query))
                .forEach(speciality => {
                    const option = document.createElement("option");
                    option.value = speciality;
                    datalist.appendChild(option);
                });
        }

        function showAnimation(event) {
            event.preventDefault();
            document.getElementById("lottie-container").style.display = "block";
            animation.play();

            setTimeout(() => {
                event.target.submit();
            }, 1500);
        }
    </script>
</head>
<body>
    <div class="formbold-main-wrapper">
        <div class="formbold-form-wrapper">
            <img src="{% static 'ProfileForm/image/hero-doc.png' %}" width="550" height="350" alt="Image du profil">
            
            <form method="POST" enctype="multipart/form-data" onsubmit="showAnimation(event)"action="{% url 'succes_page' %}">
                {% csrf_token %}
                
                <!-- Affiche les erreurs globales du formulaire, si elles existent -->
                {% if form.non_field_errors %}
                    <div class="formbold-error">
                        {% for error in form.non_field_errors %}
                            <p>{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Champ Prénom -->
                <div class="formbold-mb-3">
                    <label for="firstname" class="formbold-form-label">Prénom</label>
                    <input type="text" name="firstname" id="firstname" class="formbold-form-input" placeholder="Entrez votre prénom">
                    {% if form.firstname.errors %}
                        <div class="formbold-error">
                            {% for error in form.firstname.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Nom -->
                <div class="formbold-mb-3">
                    <label for="lastname" class="formbold-form-label">Nom</label>
                    <input type="text" name="lastname" id="lastname" class="formbold-form-input" placeholder="Entrez votre nom">
                    {% if form.lastname.errors %}
                        <div class="formbold-error">
                            {% for error in form.lastname.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Âge -->
                <div class="formbold-mb-3">
                    <label for="age" class="formbold-form-label">Âge</label>
                    <input type="number" name="age" id="age" class="formbold-form-input" placeholder="Entrez votre âge">
                    {% if form.age.errors %}
                        <div class="formbold-error">
                            {% for error in form.age.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Date de naissance -->
                <div class="formbold-mb-3">
                    <label for="dob" class="formbold-form-label">Date de naissance</label>
                    <input type="date" name="dob" id="dob" class="formbold-form-input">
                    {% if form.dob.errors %}
                        <div class="formbold-error">
                            {% for error in form.dob.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Genre -->
                <div class="formbold-mb-3">
                    <label for="gender" class="formbold-form-label">Genre</label>
                    <select name="gender" id="gender" class="formbold-form-input">
                        <option value="">Sélectionnez</option>
                        <option value="male">Homme</option>
                        <option value="female">Femme</option>
                        <option value="other">Autre</option>
                    </select>
                    {% if form.gender.errors %}
                        <div class="formbold-error">
                            {% for error in form.gender.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Email -->
                <div class="formbold-mb-3">
                    <label for="email" class="formbold-form-label">Email</label>
                    <input type="email" name="email" id="email" class="formbold-form-input" placeholder="exemple@email.com">
                    {% if form.email.errors %}
                        <div class="formbold-error">
                            {% for error in form.email.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Adresse -->
                <div class="formbold-mb-3">
                    <label for="address" class="formbold-form-label">Adresse</label>
                    <input type="text" name="address" id="address" class="formbold-form-input" placeholder="Adresse complète">
                    {% if form.address.errors %}
                        <div class="formbold-error">
                            {% for error in form.address.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ pour sélectionner entre Patient ou Docteur -->
                <div class="formbold-mb-3">
                    <label for="occupation" class="formbold-form-label">Êtes-vous patient ou docteur ?</label>
                    <select name="occupation" id="occupation" class="formbold-form-input" onchange="toggleFields()">
                        <option value="">Sélectionnez</option>
                        <option value="patient">Patient</option>
                        <option value="docteur">Docteur</option>
                    </select>
                    {% if form.occupation.errors %}
                        <div class="formbold-error">
                            {% for error in form.occupation.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ pour télécharger la licence (affiché seulement si occupation est docteur) -->
                <div class="formbold-mb-3" id="licenceField" style="display: none;">
                    <label for="licence" class="formbold-form-label">Télécharger la licence (obligatoire si docteur)</label>
                    <input type="file" name="licence" id="licence" class="formbold-form-input">
                    {% if form.licence.errors %}
                        <div class="formbold-error">
                            {% for error in form.licence.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ Spécialité pour les docteurs (avec auto-complétion) -->
                <div class="formbold-mb-3" id="specialityField" style="display: none;">
                    <label for="speciality" class="formbold-form-label">Spécialité</label>
                    <input type="text" name="speciality" id="speciality" class="formbold-form-input" placeholder="Sélectionnez votre spécialité" list="specialityList" oninput="filterSpecialities('speciality', 'specialityList')">
                    <datalist id="specialityList"></datalist>
                    {% if form.speciality.errors %}
                        <div class="formbold-error">
                            {% for error in form.speciality.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Champ pour accepter les termes et conditions -->
                <div class="formbold-checkbox-wrapper">
                    <label for="terms_accepted" class="formbold-checkbox-label">
                        <input type="checkbox" name="terms_accepted" id="terms_accepted" class="formbold-input-checkbox">
                        J'accepte les <a href="#">conditions, termes et politiques</a>
                    </label>
                    {% if form.terms_accepted.errors %}
                        <div class="formbold-error">
                            {% for error in form.terms_accepted.errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <button type="submit" class="formbold-btn">Soumettre</button>
            </form>

            <div id="lottie-container"></div>
        </div>
    </div>

    <script>
        const animation = lottie.loadAnimation({
            container: document.getElementById('lottie-container'),
            renderer: 'svg',
            loop: false,
            autoplay: false,
            path: '{% static "icons/Animation1.json" %}'
        });
    </script>
</body>
</html>
