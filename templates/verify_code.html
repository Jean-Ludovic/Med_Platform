{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verification Code</title>
    <link rel="stylesheet" type="text/css" href="{% static 'Login_v2/vendor/bootstrap/css/bootstrap.min.css' %}">
    <style>
        #fullScreenAnimation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            visibility: hidden; /* Caché par défaut */
        }

        #errorContainer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        #errorAnimation {
            width: 50px;
            height: 50px;
        }
    </style>
</head>
<body>
    <div id="fullScreenAnimation">
        <!-- Animation Lottie pleine page pour le succès -->
    </div>

    <h1>Verify Your Email</h1>

    {% if error %}
    <div id="errorContainer">
        <p style="color:red;">{{ error }}</p>
        <div id="errorAnimation"></div>
    </div>
    {% endif %}

    <form id="verification-form" method="POST">
        {% csrf_token %}
        <label for="verification_code">Enter Verification Code:</label>
        <input type="text" name="verification_code" required>
        <button type="submit">Verify</button>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.2/lottie.min.js"></script>
    <script src="{% static 'Login_v2/vendor/jquery/jquery-3.2.1.min.js' %}"></script>
    <script src="{% static 'Login_v2/vendor/bootstrap/js/bootstrap.min.js' %}"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const successAnimationContainer = document.getElementById('fullScreenAnimation');
            const errorAnimationContainer = document.getElementById('errorAnimation');
            const form = document.getElementById('verification-form');
            let isSubmitted = false;

            // Charger l'animation de succès
            const successAnimation = lottie.loadAnimation({
                container: successAnimationContainer,
                renderer: 'svg',
                loop: true,
                autoplay: false,
                path: '{% static "icons/mail-checked-animation.json" %}' // Animation pour le succès
            });

            // Charger l'animation d'erreur si elle existe
            if (errorAnimationContainer) {
                lottie.loadAnimation({
                    container: errorAnimationContainer,
                    renderer: 'svg',
                    loop: true,
                    autoplay: true,
                    path: '{% static "icons/error-animation.json" %}' // Animation pour l'erreur
                });
            }

            form.addEventListener('submit', function (e) {
                if (isSubmitted) {
                    e.preventDefault(); // Empêche une deuxième soumission
                    return;
                }

                isSubmitted = true;
                successAnimationContainer.style.visibility = 'visible'; // Affiche l'animation de succès
                successAnimation.play(); // Joue l'animation de succès

                // Désactiver le bouton de soumission
                form.querySelectorAll('button[type="submit"]').forEach(button => {
                    button.disabled = true;
                });
            });
        });
    </script>
</body>
</html>
